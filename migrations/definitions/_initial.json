{"schemas":"DEFINE TABLE component SCHEMAFULL;\n\nDEFINE FIELD vendor ON component TYPE string;\nDEFINE FIELD configuration ON component FLEXIBLE TYPE object;\nDEFINE FIELD priority ON component TYPE int DEFAULT 1 ASSERT $value >= 1;\nDEFINE TABLE controls SCHEMAFULL;\n\nDEFINE FIELD in ON TABLE controls TYPE record<component>;\nDEFINE FIELD out ON TABLE controls TYPE record<device>;\n\nDEFINE INDEX unique_controls ON TABLE controls COLUMNS in, out UNIQUE;\nDEFINE TABLE device SCHEMAFULL;\n\nDEFINE FIELD name ON device TYPE string;\nDEFINE FIELD serial ON device TYPE string;\nDEFINE FIELD model ON device TYPE string;\nDEFINE FIELD manufacturer ON device TYPE string;\nDEFINE FIELD sw_version ON device TYPE option<string>;\nDEFINE FIELD hw_version ON device TYPE option<string>;\nDEFINE TABLE entity SCHEMAFULL;\n\nDEFINE FIELD enabled ON entity TYPE bool DEFAULT true;\nDEFINE FIELD available ON entity TYPE bool DEFAULT true;\nDEFINE FIELD class ON entity TYPE string;\nDEFINE FIELD attributes ON entity TYPE option<object>;\nDEFINE FIELD interface ON entity TYPE string ASSERT $value != null;\nDEFINE FIELD state ON entity FLEXIBLE TYPE object;\n\nDEFINE EVENT state_attributes_changed ON TABLE entity WHEN $before.state.attributes != $after.state.attributes THEN (\n    UPDATE $after.id SET state.updated_at = time::now()\n);\nDEFINE TABLE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD script_name ON script_migration TYPE string;\nDEFINE FIELD executed_at ON script_migration TYPE datetime DEFAULT time::now();\nDEFINE TABLE updates SCHEMAFULL;\n\nDEFINE FIELD in ON TABLE updates TYPE record<device> ASSERT $value != NONE;\nDEFINE FIELD out ON TABLE updates TYPE record<entity> ASSERT $value != NONE;\nDEFINE FIELD with_polling ON TABLE updates TYPE bool DEFAULT true ASSERT $value != NONE;\nDEFINE FIELD polling_interval ON TABLE updates TYPE number DEFAULT 120 ASSERT $value > 0;\n\nDEFINE INDEX unique_updates ON TABLE updates COLUMNS in, out UNIQUE;","events":""}